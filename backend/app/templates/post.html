{% extends "base.html" %}

{% block og_type %}article{% endblock %}

{% block body_class %}single-post{% endblock %}

{% block main_class %}main-content{% endblock %}

{% block content %}
<div class="page-container">
    <div class="content-layout">
        <!-- Main Content -->
        <div class="main-column">
            <article class="post-content">
                <!-- Post Header -->
                <header class="post-header">
                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb" class="breadcrumb-nav">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{ base_url }}/">Inicio</a></li>
                            {% if category %}
                            <li class="breadcrumb-item">
                                <a href="{{ base_url }}/categories/{{ category.slug }}">{{ category.name }}</a>
                            </li>
                            {% endif %}
                            <li class="breadcrumb-item active" aria-current="page">
                                {{ post.title|truncate_words(5) }}
                            </li>
                        </ol>
                    </nav>
                    
                    <!-- Category Badge -->
                    {% if category %}
                    <div class="category-badge-container">
                        <a href="{{ base_url }}/categories/{{ category.slug }}" class="category-badge">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M10 4H4c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm10 9h-6c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2v-6c0-1.11-.89-2-2-2zM10 13H4c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2v-6c0-1.11-.89-2-2-2zm10-9h-6c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2z"/>
                            </svg>
                            {{ category.name }}
                        </a>
                    </div>
                    {% endif %}
                    
                    <!-- Post Title -->
                    <h1 class="post-title">{{ post.title }}</h1>
                    
                    <!-- Post Meta -->
                    <div class="post-meta">
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                            </svg>
                            <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at|format_date }}</time>
                        </div>
                        
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"/>
                            </svg>
                            <span>{{ post.content|reading_time }} min lectura</span>
                        </div>
                        
                        {% if post.updated_at and post.updated_at != post.created_at %}
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                            </svg>
                            <span>Actualizado: {{ post.updated_at|format_date('%d/%m/%Y') }}</span>
                        </div>
                        {% endif %}
                        
                        {% if keyword %}
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7,14A3,3 0 0,1 10,17A3,3 0 0,1 7,20A3,3 0 0,1 4,17A3,3 0 0,1 7,14M7,10.5C8,9 9,8.5 11,8.5C13,8.5 14,9 15,10.5C16,12 16,13 16,13.5H14.5C14.5,13 14.5,12.5 14,12C13.5,11.5 12.5,11.5 11,11.5C9.5,11.5 8.5,11.5 8,12C7.5,12.5 7.5,13 7.5,13.5H6C6,13 6,12 7,10.5M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2Z"/>
                            </svg>
                            <span>{{ keyword.name }}</span>
                        </div>
                        {% endif %}
                        
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
                            </svg>
                            <span>{{ post.user.username if post.user else 'Autopublicador Web' }}</span>
                        </div>
                    </div>
                    
                    <!-- Featured Image -->
                    {% if images %}
                    {% set featured_image = images|selectattr('is_featured')|first or images[0] %}
                    <div class="post-featured-image">
                        <figure class="post-figure">
                            <img src="{{ featured_image.image_path }}" 
                                 alt="{{ featured_image.alt_text or post.title }}" 
                                 class="post-image"
                                 style="max-height: 400px; object-fit: cover;">
                            {% if featured_image.alt_text %}
                            <figcaption class="image-caption">
                                {{ featured_image.alt_text }}
                            </figcaption>
                            {% endif %}
                        </figure>
                    </div>
                    {% endif %}
                    
                    <!-- Tags -->
                    {% if tags %}
                    <div class="post-tags">
                        <span class="tags-label">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.78 12.45,22 13,22C13.55,22 14.05,21.78 14.41,21.41L21.41,14.41C21.78,14.05 22,13.55 22,13C22,12.45 21.78,11.95 21.41,11.58Z"/>
                            </svg>
                            Etiquetas:
                        </span>
                        {% for tag in tags %}
                        <a href="/tags/{{ tag.slug }}" class="tag-link">
                            #{{ tag.name }}
                        </a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </header>
                
                <!-- Post Content -->
                <div class="post-body">
                    <div class="content-text">
                        {{ post.content|safe }}
                    </div>
                    
                    <!-- Additional Images -->
                    {% if images|length > 1 %}
                    <div class="post-gallery">
                        <h3 class="gallery-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M22,16A2,2 0 0,1 20,18H4A2,2 0 0,1 2,16V6C2,4.89 2.9,4 4,4H20A2,2 0 0,1 22,6V16M11.5,12L13.5,14.5L17,10L21,15H3L11.5,12Z"/>
                            </svg>
                            Galería de Imágenes
                        </h3>
                        <div class="gallery-grid">
                            {% for image in images %}
                            {% if not image.is_featured %}
                            <div class="gallery-item">
                                <figure class="image-figure">
                                    <img src="{{ image.image_path }}" 
                                         alt="{{ image.alt_text or post.title }}" 
                                         class="gallery-image"
                                         onclick="openImageModal('{{ loop.index }}')"
                                         style="cursor: pointer;">
                                    {% if image.alt_text %}
                                    <figcaption class="image-caption">
                                        {{ image.alt_text }}
                                    </figcaption>
                                    {% endif %}
                                </figure>
                                
                                <!-- Image Modal -->
                                <div class="image-modal" id="imageModal{{ loop.index }}" style="display: none;">
                                    <div class="modal-overlay" onclick="closeImageModal('{{ loop.index }}')"></div>
                                    <div class="modal-container">
                                        <div class="modal-header">
                                            <h5 class="modal-title">{{ image.alt_text or post.title }}</h5>
                                            <button type="button" class="modal-close" onclick="closeImageModal('{{ loop.index }}')">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <img src="{{ image.image_path }}" 
                                                 alt="{{ image.alt_text or post.title }}" 
                                                 class="modal-image">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Post Footer -->
                <footer class="post-footer">
                    <!-- Share Buttons -->
                    <div class="share-buttons">
                        <h5 class="share-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z"/>
                            </svg>
                            Compartir este artículo
                        </h5>
                        <div class="share-buttons-grid">
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url if request else '' }}" 
                               target="_blank" 
                               class="share-btn share-btn-facebook">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                </svg>
                                Facebook
                            </a>
                            <a href="https://twitter.com/intent/tweet?url={{ request.url if request else '' }}&text={{ post.title|urlencode }}" 
                               target="_blank" 
                               class="share-btn share-btn-twitter">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                </svg>
                                Twitter
                            </a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url if request else '' }}" 
                               target="_blank" 
                               class="share-btn share-btn-linkedin">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                </svg>
                                LinkedIn
                            </a>
                            <a href="https://wa.me/?text={{ post.title|urlencode }}%20{{ request.url if request else '' }}" 
                               target="_blank" 
                               class="share-btn share-btn-whatsapp">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.488"/>
                                </svg>
                                WhatsApp
                            </a>
                            <button class="share-btn share-btn-copy" onclick="copyToClipboard()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
                                </svg>
                                Copiar enlace
                            </button>
                        </div>
                    </div>
                    
                    <!-- Post Navigation -->
                    {% if prev_post or next_post %}
                    <nav class="post-navigation">
                        <div class="nav-grid">
                            {% if prev_post %}
                            <div class="nav-item prev-post">
                                <small class="nav-label">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
                                    </svg>
                                    Artículo anterior
                                </small>
                                <a href="{{ base_url }}/posts/{{ prev_post.slug }}" class="nav-link">
                                    <h6 class="nav-title">{{ prev_post.title }}</h6>
                                </a>
                            </div>
                            {% endif %}
                            
                            {% if next_post %}
                            <div class="nav-item next-post {% if not prev_post %}next-only{% endif %}">
                                <small class="nav-label">
                                    Siguiente artículo
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
                                    </svg>
                                </small>
                                <a href="{{ base_url }}/posts/{{ next_post.slug }}" class="nav-link">
                                    <h6 class="nav-title">{{ next_post.title }}</h6>
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </nav>
                    {% endif %}
                </footer>
            </article>
            
            <!-- Related Posts -->
            {% if related_posts %}
            <section class="related-posts">
                <h2 class="section-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4,6H2V20A2,2 0 0,0 4,22H18V20H4V6M20,2H8A2,2 0 0,0 6,4V16A2,2 0 0,0 8,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M20,16H8V4H20V16Z"/>
                    </svg>
                    Artículos relacionados
                </h2>
                <div class="related-grid">
                    {% for related_post in related_posts[:3] %}
                    <article class="related-card">
                        {% if related_post.images %}
                        {% set related_image = related_post.images|selectattr('is_featured')|first or related_post.images[0] %}
                        <div class="related-image">
                            <img src="{{ related_image.image_path }}" 
                                 alt="{{ related_image.alt_text or related_post.title }}" 
                                 class="related-img">
                            <div class="image-overlay"></div>
                        </div>
                        {% endif %}
                        
                        <div class="related-content">
                            <h3 class="related-title">
                                <a href="{{ base_url }}/posts/{{ related_post.slug }}" class="related-link">
                                    {{ related_post.title }}
                                </a>
                            </h3>
                            
                            <p class="related-excerpt">{{ related_post.content|striptags|truncate_words(15) }}</p>
                            
                            <div class="related-meta">
                                <span class="meta-item">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                                    </svg>
                                    {{ related_post.created_at|format_date('%d/%m/%Y') }}
                                </span>
                                <span class="meta-item">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"/>
                                    </svg>
                                    {{ related_post.content|reading_time }} min
                                </span>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <aside class="sidebar-column">
            <div class="sidebar-sticky">
                <!-- Table of Contents -->
                <div class="widget">
                    <div class="widget-card">
                        <div class="widget-header">
                            <h5 class="widget-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3,5H9V11H3V5M5,7V9H7V7H5M11,7H21V9H11V7M11,15H21V17H11V15M5,20L1.5,16.5L2.91,15.09L5,17.17L9.59,12.59L11,14L5,20Z"/>
                                </svg>
                                Contenido del Artículo
                            </h5>
                        </div>
                        <div class="widget-body">
                            <div id="tableOfContents">
                                <p class="widget-placeholder">El índice se generará automáticamente...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Category Info -->
                {% if category %}
                <div class="widget">
                    <div class="widget-card">
                        <div class="widget-header">
                            <h5 class="widget-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M10 4H4c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm10 9h-6c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2v-6c0-1.11-.89-2-2-2zM10 13H4c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2v-6c0-1.11-.89-2-2-2zm10-9h-6c-1.11 0-2 .89-2 2v6c0 1.11.89 2 2 2h6c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2z"/>
                                </svg>
                                Categoría
                            </h5>
                        </div>
                        <div class="widget-body">
                            <h6 class="category-name">
                                <a href="{{ base_url }}/categories/{{ category.slug }}" class="category-link">
                                    {{ category.name }}
                                </a>
                            </h6>
                            {% if category.description %}
                            <p class="category-description">{{ category.description }}</p>
                            {% endif %}
                            <a href="{{ base_url }}/categories/{{ category.slug }}" class="widget-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                                </svg>
                                Ver más artículos
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Popular Posts -->
                <div class="widget">
                    <div class="widget-card">
                        <div class="widget-header">
                            <h5 class="widget-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M17.66,11.2C17.43,10.9 17.15,10.64 16.89,10.38C16.22,9.78 15.46,9.35 14.82,8.72C13.33,7.26 13,4.85 13.95,3C13,3.23 12.17,3.75 11.46,4.32C8.87,6.4 7.85,10.07 9.07,13.22C9.11,13.32 9.15,13.42 9.15,13.55C9.15,13.77 9,13.97 8.8,14.05C8.57,14.15 8.33,14.09 8.14,13.93C8.08,13.88 8.04,13.83 8,13.76C6.87,12.33 6.69,10.28 7.45,8.64C5.78,10 4.87,12.3 5,14.47C5.06,14.97 5.12,15.47 5.29,15.97C5.43,16.57 5.7,17.17 6,17.7C7.08,19.43 8.95,20.67 10.96,20.92C13.1,21.19 15.39,20.8 17.03,19.32C18.86,17.66 19.5,15 18.56,12.72L18.43,12.46C18.22,12 17.66,11.2 17.66,11.2M14.5,17.5C14.22,17.74 13.76,18 13.4,18.1C12.28,18.5 11.16,17.94 10.5,17.28C11.69,17 12.4,16.12 12.61,15.23C12.78,14.43 12.46,13.77 12.33,13C12.21,12.26 12.23,11.63 12.5,10.94C12.69,11.32 12.89,11.7 13.13,12C13.9,13 15.11,13.44 15.37,14.8C15.41,14.94 15.43,15.08 15.43,15.23C15.46,16.05 15.1,16.95 14.5,17.5H14.5Z"/>
                                </svg>
                                Artículos Populares
                            </h5>
                        </div>
                        <div class="widget-body">
                            <!-- Aquí se cargarían los posts populares -->
                            <p class="widget-placeholder">Próximamente: artículos más leídos</p>
                        </div>
                    </div>
                </div>
                
                <!-- Newsletter Signup -->
                <div class="widget">
                    <div class="widget-card newsletter-widget">
                        <div class="widget-body newsletter-body">
                            <h5 class="newsletter-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/>
                                </svg>
                                Suscríbete
                            </h5>
                            <p class="newsletter-description">Recibe contenido místico en tu correo</p>
                            <form class="newsletter-form">
                                <div class="form-group">
                                    <input type="email" class="newsletter-input" placeholder="Tu email" required>
                                </div>
                                <button type="submit" class="newsletter-btn">
                                    Suscribirse
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Page Layout */
    .page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }
    
    .content-layout {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 3rem;
        align-items: start;
    }
    
    .main-column {
        min-width: 0;
    }
    
    .sidebar-column {
        position: relative;
    }
    
    .sidebar-sticky {
        position: sticky;
        top: 2rem;
    }
    
    /* Post Header */
    .post-header {
        margin-bottom: 2rem;
    }
    
    .breadcrumb-nav {
        margin-bottom: 1rem;
    }
    
    .breadcrumb {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 0.9rem;
    }
    
    .breadcrumb-item {
        color: #6c757d;
    }
    
    .breadcrumb-item + .breadcrumb-item::before {
        content: "/";
        margin: 0 0.5rem;
        color: #dee2e6;
    }
    
    .breadcrumb-item a {
        color: #007bff;
        text-decoration: none;
    }
    
    .breadcrumb-item a:hover {
        text-decoration: underline;
    }
    
    .breadcrumb-item.active {
        color: #6c757d;
    }
    
    .category-badge-container {
        margin-bottom: 1rem;
    }
    
    .category-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        font-weight: 500;
        transition: background-color 0.2s;
    }
    
    .category-badge:hover {
        background: #0056b3;
        color: white;
    }
    
    .post-title {
        font-size: 2.5rem;
        font-weight: 700;
        line-height: 1.2;
        color: #2c3e50;
        margin-bottom: 1.5rem;
    }
    
    .post-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        margin-bottom: 2rem;
        font-size: 0.9rem;
        color: #6c757d;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    /* Featured Image */
    .post-featured-image {
        margin-bottom: 2rem;
    }
    
    .post-figure {
        margin: 0;
    }
    
    .post-image {
        width: 100%;
        height: auto;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .image-caption {
        font-size: 0.9rem;
        color: #6c757d;
        margin-top: 0.5rem;
        text-align: center;
    }
    
    /* Tags */
    .post-tags {
        margin-bottom: 2rem;
    }
    
    .tags-label {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin-right: 1rem;
        font-weight: 500;
        color: #6c757d;
    }
    
    .tag-link {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 0.25rem;
        text-decoration: none;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        color: #212529;
        transition: all 0.2s;
    }
    
    .tag-link:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        color: #007bff;
        border-color: #007bff;
    }
    
    /* Content */
    .content-text {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #333;
        margin-bottom: 3rem;
    }
    
    .content-text h1,
    .content-text h2,
    .content-text h3,
    .content-text h4,
    .content-text h5,
    .content-text h6 {
        color: #2c3e50;
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-weight: 600;
    }
    
    .content-text p {
        margin-bottom: 1.5rem;
    }
    
    .content-text blockquote {
        border-left: 4px solid #007bff;
        padding: 1rem;
        margin: 2rem 0;
        font-style: italic;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
    }
    
    .content-text ul,
    .content-text ol {
        margin-bottom: 1.5rem;
        padding-left: 2rem;
    }
    
    .content-text li {
        margin-bottom: 0.5rem;
    }
    
    /* Gallery */
    .post-gallery {
        margin-bottom: 3rem;
    }
    
    .gallery-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 2rem;
        color: #2c3e50;
    }
    
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    
    .gallery-item {
        position: relative;
    }
    
    .image-figure {
        margin: 0;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.2s;
    }
    
    .image-figure:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    .gallery-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        transition: transform 0.3s;
    }
    
    .gallery-image:hover {
        transform: scale(1.05);
    }
    
    .image-caption {
        padding: 0.75rem;
        background: #f8f9fa;
        font-size: 0.9rem;
        color: #6c757d;
        text-align: center;
    }
    
    /* Image Modal */
    .image-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1050;
        background: rgba(0, 0, 0, 0.8);
    }
    
    .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    
    .modal-container {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
        margin: 5vh auto;
        background: white;
        border-radius: 0.5rem;
        overflow: hidden;
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
    }
    
    .modal-title {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.25rem;
        transition: background-color 0.2s;
    }
    
    .modal-close:hover {
        background: #f8f9fa;
    }
    
    .modal-body {
        padding: 1rem;
    }
    
    .modal-image {
        width: 100%;
        height: auto;
        max-height: 70vh;
        object-fit: contain;
    }
    
    /* Post Footer */
    .post-footer {
        border-top: 1px solid #dee2e6;
        padding-top: 2rem;
        margin-top: 3rem;
    }
    
    /* Share Buttons */
    .share-buttons {
        margin-bottom: 2rem;
    }
    
    .share-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #2c3e50;
    }
    
    .share-buttons-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .share-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border: 1px solid;
        border-radius: 0.25rem;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s;
        background: white;
        cursor: pointer;
    }
    
    .share-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .share-btn-facebook {
        color: #1877f2;
        border-color: #1877f2;
    }
    
    .share-btn-facebook:hover {
        background: #1877f2;
        color: white;
    }
    
    .share-btn-twitter {
        color: #1da1f2;
        border-color: #1da1f2;
    }
    
    .share-btn-twitter:hover {
        background: #1da1f2;
        color: white;
    }
    
    .share-btn-linkedin {
        color: #0077b5;
        border-color: #0077b5;
    }
    
    .share-btn-linkedin:hover {
        background: #0077b5;
        color: white;
    }
    
    .share-btn-whatsapp {
        color: #25d366;
        border-color: #25d366;
    }
    
    .share-btn-whatsapp:hover {
        background: #25d366;
        color: white;
    }
    
    .share-btn-copy {
        color: #6c757d;
        border-color: #6c757d;
    }
    
    .share-btn-copy:hover {
        background: #6c757d;
        color: white;
    }
    
    /* Post Navigation */
    .post-navigation {
        margin-bottom: 2rem;
    }
    
    .nav-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
    
    .nav-item {
        padding: 1rem;
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        transition: all 0.2s;
    }
    
    .nav-item:hover {
        border-color: #007bff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .nav-item.next-only {
        grid-column: 2;
    }
    
    .nav-item.next-post {
        text-align: right;
    }
    
    .nav-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 0.5rem;
    }
    
    .nav-item.next-post .nav-label {
        justify-content: flex-end;
    }
    
    .nav-link {
        text-decoration: none;
        color: #2c3e50;
    }
    
    .nav-title {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
        line-height: 1.3;
    }
    
    /* Related Posts */
    .related-posts {
        margin-bottom: 3rem;
    }
    
    .section-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 2rem;
        color: #2c3e50;
    }
    
    .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
    }
    
    .related-card {
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        overflow: hidden;
        transition: all 0.2s;
        background: white;
    }
    
    .related-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-color: #007bff;
    }
    
    .related-image {
        position: relative;
        height: 200px;
        overflow: hidden;
    }
    
    .related-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }
    
    .related-card:hover .related-img {
        transform: scale(1.05);
    }
    
    .image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.1);
        transition: background-color 0.2s;
    }
    
    .related-card:hover .image-overlay {
        background: rgba(0, 0, 0, 0.2);
    }
    
    .related-content {
        padding: 1.5rem;
    }
    
    .related-title {
        margin: 0 0 1rem 0;
        font-size: 1.1rem;
        font-weight: 600;
        line-height: 1.3;
    }
    
    .related-link {
        color: #2c3e50;
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .related-link:hover {
        color: #007bff;
    }
    
    .related-excerpt {
        color: #6c757d;
        font-size: 0.9rem;
        line-height: 1.5;
        margin-bottom: 1rem;
    }
    
    .related-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .related-meta .meta-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    /* Widgets */
    .widget {
        margin-bottom: 2rem;
    }
    
    .widget-card {
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        overflow: hidden;
        background: white;
        transition: all 0.2s;
    }
    
    .widget-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .widget-header {
        background: #f8f9fa;
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
    }
    
    .widget-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .widget-body {
        padding: 1rem;
    }
    
    .widget-placeholder {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 0;
    }
    
    .category-name {
        margin: 0 0 1rem 0;
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .category-link {
        color: #007bff;
        text-decoration: none;
    }
    
    .category-link:hover {
        text-decoration: underline;
    }
    
    .category-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
    
    .widget-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 0.25rem;
        font-size: 0.9rem;
        font-weight: 500;
        transition: background-color 0.2s;
        width: 100%;
        justify-content: center;
    }
    
    .widget-btn:hover {
        background: #0056b3;
        color: white;
    }
    
    /* Newsletter Widget */
    .newsletter-widget {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
    }
    
    .newsletter-body {
        text-align: center;
        padding: 2rem 1rem;
    }
    
    .newsletter-title {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin: 0 0 1rem 0;
        font-size: 1.25rem;
        font-weight: 600;
    }
    
    .newsletter-description {
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .newsletter-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .form-group {
        margin: 0;
    }
    
    .newsletter-input {
        width: 100%;
        padding: 0.75rem;
        border: none;
        border-radius: 0.25rem;
        font-size: 0.9rem;
        box-sizing: border-box;
    }
    
    .newsletter-input:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
    }
    
    .newsletter-btn {
        padding: 0.75rem;
        background: white;
        color: #007bff;
        border: none;
        border-radius: 0.25rem;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .newsletter-btn:hover {
        background: #f8f9fa;
        transform: translateY(-1px);
    }
    
    /* Table of Contents */
    .toc-list {
        list-style: none;
        padding-left: 0;
    }
    
    .toc-item {
        margin-bottom: 0.25rem;
    }
    
    .toc-item.indent {
        margin-left: 1rem;
    }
    
    .toc-link {
        text-decoration: none;
        font-size: 0.875rem;
        color: #007bff;
        transition: color 0.2s;
    }
    
    .toc-link:hover {
        color: #0056b3;
    }
    
    .toc-placeholder {
        color: #6c757d;
        font-size: 0.875rem;
        margin: 0;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .content-layout {
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        
        .sidebar-sticky {
            position: static;
        }
        
        .post-title {
            font-size: 2rem;
        }
        
        .content-text {
            font-size: 1rem;
        }
        
        .post-meta {
            font-size: 0.8rem;
            gap: 1rem;
        }
        
        .nav-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .nav-item.next-only {
            grid-column: 1;
        }
        
        .nav-item.next-post {
            text-align: left;
        }
        
        .nav-item.next-post .nav-label {
            justify-content: flex-start;
        }
        
        .related-grid {
            grid-template-columns: 1fr;
        }
        
        .gallery-grid {
            grid-template-columns: 1fr;
        }
        
        .gap-2 {
            gap: 0.25rem;
        }
        
        .btn {
            font-size: 0.8rem;
            padding: 0.375rem 0.75rem;
        }
        
        .modal-container {
            max-width: 95vw;
            margin: 2.5vh auto;
        }
    }
    
    @media (max-width: 480px) {
        .page-container {
            padding: 1rem 0.5rem;
        }
        
        .post-title {
            font-size: 1.75rem;
        }
        
        .post-meta {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .d-flex {
            flex-direction: column;
        }
        
        .btn {
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
// Copy to clipboard functionality
function copyToClipboard() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(function() {
        // Show success message
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>¡Copiado!';
        btn.classList.remove('btn-outline-secondary');
        btn.classList.add('btn-success');
        
        setTimeout(function() {
            btn.innerHTML = originalText;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-outline-secondary');
        }, 2000);
    });
}

// Image modal functionality
function openImageModal(index) {
    const modal = document.getElementById('imageModal' + index);
    if (modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
}

function closeImageModal(index) {
    const modal = document.getElementById('imageModal' + index);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Generate Table of Contents
document.addEventListener('DOMContentLoaded', function() {
    const contentText = document.querySelector('.content-text');
    const tocContainer = document.getElementById('tableOfContents');
    
    if (contentText && tocContainer) {
        const headings = contentText.querySelectorAll('h2, h3, h4');
        
        if (headings.length > 0) {
            let tocHTML = '<ul class="list-unstyled">';
            
            headings.forEach(function(heading, index) {
                const id = 'heading-' + index;
                heading.id = id;
                
                const level = parseInt(heading.tagName.charAt(1));
                const indent = level > 2 ? 'ms-3' : '';
                
                tocHTML += `
                    <li class="${indent} mb-1">
                        <a href="#${id}" class="text-decoration-none small">
                            ${heading.textContent}
                        </a>
                    </li>
                `;
            });
            
            tocHTML += '</ul>';
            tocContainer.innerHTML = tocHTML;
            
            // Smooth scrolling for TOC links
            tocContainer.querySelectorAll('a').forEach(function(link) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        } else {
            tocContainer.innerHTML = '<p class="text-muted small">No hay encabezados en este artículo.</p>';
        }
    }
    
    // Close modal on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modals = document.querySelectorAll('.image-modal');
            modals.forEach(function(modal) {
                if (modal.style.display === 'block') {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }
    });
});

// Reading progress indicator
document.addEventListener('DOMContentLoaded', function() {
    const progressBar = document.createElement('div');
    progressBar.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 0%;
        height: 3px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        z-index: 9999;
        transition: width 0.3s ease;
    `;
    document.body.appendChild(progressBar);
    
    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset;
        const docHeight = document.body.scrollHeight - window.innerHeight;
        const scrollPercent = (scrollTop / docHeight) * 100;
        progressBar.style.width = scrollPercent + '%';
    });
});
</script>
{% endblock %}